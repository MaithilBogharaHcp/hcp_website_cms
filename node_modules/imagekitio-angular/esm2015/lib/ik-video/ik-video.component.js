import { Component, ElementRef, Input } from '@angular/core';
import { ImagekitService } from '../imagekitio-angular.service';
import * as i0 from "@angular/core";
import * as i1 from "../imagekitio-angular.service";
export class IkVideoComponent {
    constructor(el, imagekit) {
        this.el = el;
        this.imagekit = imagekit;
        this.transformation = [];
        this.url = '';
    }
    ngOnInit() {
        const options = this.src ? { src: this.src } : { path: this.path };
        options.transformation = this.transformation;
        options.transformationPosition = this.transformationPosition;
        options.urlEndpoint = this.urlEndpoint;
        options.queryParameters = this.queryParameters;
        this.setUrl(options);
    }
    ngAfterViewInit() {
        this.loadVideo(this.url);
    }
    loadVideo(url) {
        const nativeElement = this.el.nativeElement;
        const attributes = nativeElement.attributes;
        const attrsToSet = this.namedNodeMapToObject(attributes);
        attrsToSet['src'] = url;
        const video = nativeElement.children[0];
        this.setElementAttributes(video, attrsToSet);
    }
    namedNodeMapToObject(source) {
        let target = {};
        Object.keys(source).forEach(index => {
            const name = source[index].name;
            const value = source[index].value;
            target[name] = value;
        });
        return target;
    }
    ;
    setUrl(options) {
        const config = this.getConfigObject(options);
        this.url = this.imagekit.getUrl(config);
    }
    getConfigObject(options) {
        const config = {
            transformation: options.transformation,
        };
        if (options.urlEndpoint) {
            config['urlEndpoint'] = options.urlEndpoint;
        }
        else {
            throw new Error('Missing urlEndpoint initialization!');
        }
        if (options.queryParameters) {
            config['queryParameters'] = options.queryParameters;
        }
        if (options.src) {
            config['src'] = options.src;
            config['transformationPosition'] = 'query';
        }
        else if (options.path) {
            config['path'] = options.path;
            if (options.transformationPosition) {
                config['transformationPosition'] = options.transformationPosition;
            }
        }
        else {
            throw new Error('Missing src / path during initialization!');
        }
        return config;
    }
    setElementAttributes(element, attributesLiteral) {
        Object.keys(attributesLiteral).forEach(attrName => {
            element.setAttribute(attrName, attributesLiteral[attrName]);
        });
    }
}
IkVideoComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: IkVideoComponent, deps: [{ token: i0.ElementRef }, { token: i1.ImagekitService }], target: i0.ɵɵFactoryTarget.Component });
IkVideoComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.17", type: IkVideoComponent, selector: "ik-video", inputs: { urlEndpoint: "urlEndpoint", path: "path", src: "src", transformation: "transformation", transformationPosition: "transformationPosition", queryParameters: "queryParameters" }, ngImport: i0, template: `<video controls><source src={{src}}>`, isInline: true });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.17", ngImport: i0, type: IkVideoComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'ik-video',
                    template: `<video controls><source src={{src}}>`,
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i1.ImagekitService }]; }, propDecorators: { urlEndpoint: [{
                type: Input,
                args: ['urlEndpoint']
            }], path: [{
                type: Input,
                args: ['path']
            }], src: [{
                type: Input,
                args: ['src']
            }], transformation: [{
                type: Input,
                args: ['transformation']
            }], transformationPosition: [{
                type: Input,
                args: ['transformationPosition']
            }], queryParameters: [{
                type: Input,
                args: ['queryParameters']
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaWstdmlkZW8uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvaW1hZ2VraXRpby1hbmd1bGFyL3NyYy9saWIvaWstdmlkZW8vaWstdmlkZW8uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsVUFBVSxFQUFFLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNyRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sK0JBQStCLENBQUM7OztBQVVoRSxNQUFNLE9BQU8sZ0JBQWdCO0lBUzNCLFlBQW9CLEVBQWMsRUFBVSxRQUF5QjtRQUFqRCxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBaUI7UUFMNUMsbUJBQWMsR0FBMEIsRUFBRSxDQUFDO1FBR3BFLFFBQUcsR0FBRyxFQUFFLENBQUM7SUFFZ0UsQ0FBQztJQUUxRSxRQUFRO1FBQ04sTUFBTSxPQUFPLEdBQTZCLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEVBQUMsR0FBRyxFQUFFLElBQUksQ0FBQyxHQUFHLEVBQUMsQ0FBQyxDQUFDLENBQUMsRUFBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBQyxDQUFDO1FBQ3pGLE9BQU8sQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQztRQUM3QyxPQUFPLENBQUMsc0JBQXNCLEdBQUcsSUFBSSxDQUFDLHNCQUFzQixDQUFDO1FBQzdELE9BQU8sQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQztRQUN2QyxPQUFPLENBQUMsZUFBZSxHQUFHLElBQUksQ0FBQyxlQUFlLENBQUM7UUFDL0MsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUN2QixDQUFDO0lBRUQsZUFBZTtRQUNYLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxD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QWdCO2tCQUw1QixTQUFTO21CQUFDO29CQUNULFFBQVEsRUFBRSxVQUFVO29CQUNwQixRQUFRLEVBQUUsc0NBQXNDO2lCQUNqRDsrSEFHdUIsV0FBVztzQkFBaEMsS0FBSzt1QkFBQyxhQUFhO2dCQUNMLElBQUk7c0JBQWxCLEtBQUs7dUJBQUMsTUFBTTtnQkFDQyxHQUFHO3NCQUFoQixLQUFLO3VCQUFDLEtBQUs7Z0JBQ2EsY0FBYztzQkFBdEMsS0FBSzt1QkFBQyxnQkFBZ0I7Z0JBQ1Usc0JBQXNCO3NCQUF0RCxLQUFLO3VCQUFDLHdCQUF3QjtnQkFDTCxlQUFlO3NCQUF4QyxLQUFLO3VCQUFDLGlCQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBFbGVtZW50UmVmLCBJbnB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSW1hZ2VraXRTZXJ2aWNlIH0gZnJvbSAnLi4vaW1hZ2VraXRpby1hbmd1bGFyLnNlcnZpY2UnO1xuaW1wb3J0IHsgSWtWaWRlb0NvbXBvbmVudE9wdGlvbnMsIFF1ZXJ5UGFyYW1ldGVycywgRGljdCB9IGZyb20gJy4uL3V0aWxpdHkvaWstdHlwZS1kZWYtY29sbGVjdGlvbidcbmltcG9ydCB7IFRyYW5zZm9ybWF0aW9uIH0gZnJvbSAnaW1hZ2VraXQtamF2YXNjcmlwdC9kaXN0L3NyYy9pbnRlcmZhY2VzL1RyYW5zZm9ybWF0aW9uJztcblxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdpay12aWRlbycsXG4gIHRlbXBsYXRlOiBgPHZpZGVvIGNvbnRyb2xzPjxzb3VyY2Ugc3JjPXt7c3JjfX0+YCxcbn0pXG5cbmV4cG9ydCBjbGFzcyBJa1ZpZGVvQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgQElucHV0KCd1cmxFbmRwb2ludCcpIHVybEVuZHBvaW50OiBzdHJpbmc7XG4gIEBJbnB1dCgncGF0aCcpIHBhdGg6IHN0cmluZzsgLy9yZXF1aXJlZFxuICBASW5wdXQoJ3NyYycpIHNyYzogc3RyaW5nOyAvL3JlcXVpcmVkXG4gIEBJbnB1dCgndHJhbnNmb3JtYXRpb24nKSB0cmFuc2Zvcm1hdGlvbjogQXJyYXk8VHJhbnNmb3JtYXRpb24+ID0gW107XG4gIEBJbnB1dCgndHJhbnNmb3JtYXRpb25Qb3NpdGlvbicpIHRyYW5zZm9ybWF0aW9uUG9zaXRpb246IFwicGF0aFwiIHwgXCJxdWVyeVwiO1xuICBASW5wdXQoJ3F1ZXJ5UGFyYW1ldGVycycpIHF1ZXJ5UGFyYW1ldGVyczogUXVlcnlQYXJhbWV0ZXJzO1xuICB1cmwgPSAnJztcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsOiBFbGVtZW50UmVmLCBwcml2YXRlIGltYWdla2l0OiBJbWFnZWtpdFNlcnZpY2UpIHsgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIGNvbnN0IG9wdGlvbnM6IElrVmlkZW9Db21wb25lbnRPcHRpb25zID0gIHRoaXMuc3JjID8ge3NyYzogdGhpcy5zcmN9IDoge3BhdGg6IHRoaXMucGF0aH07XG4gICAgb3B0aW9ucy50cmFuc2Zvcm1hdGlvbiA9IHRoaXMudHJhbnNmb3JtYXRpb247XG4gICAgb3B0aW9ucy50cmFuc2Zvcm1hdGlvblBvc2l0aW9uID0gdGhpcy50cmFuc2Zvcm1hdGlvblBvc2l0aW9uO1xuICAgIG9wdGlvbnMudXJsRW5kcG9pbnQgPSB0aGlzLnVybEVuZHBvaW50O1xuICAgIG9wdGlvbnMucXVlcnlQYXJhbWV0ZXJzID0gdGhpcy5xdWVyeVBhcmFtZXRlcnM7XG4gICAgdGhpcy5zZXRVcmwob3B0aW9ucyk7XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgICB0aGlzLmxvYWRWaWRlbyh0aGlzLnVybCk7XG4gIH1cblxuICBsb2FkVmlkZW8odXJsOnN0cmluZyk6IHZvaWQge1xuICAgICAgY29uc3QgbmF0aXZlRWxlbWVudCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudDtcbiAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBuYXRpdmVFbGVtZW50LmF0dHJpYnV0ZXM7XG4gICAgICBjb25zdCBhdHRyc1RvU2V0ID0gdGhpcy5uYW1lZE5vZGVNYXBUb09iamVjdChhdHRyaWJ1dGVzKTtcbiAgICAgIGF0dHJzVG9TZXRbJ3NyYyddID0gdXJsO1xuICAgICAgY29uc3QgdmlkZW8gPSBuYXRpdmVFbGVtZW50LmNoaWxkcmVuWzBdO1xuICAgICAgdGhpcy5zZXRFbGVtZW50QXR0cmlidXRlcyh2aWRlbywgYXR0cnNUb1NldCk7XG4gIH1cblxuICBuYW1lZE5vZGVNYXBUb09iamVjdChzb3VyY2U6IE5hbWVkTm9kZU1hcCk6IERpY3Qge1xuICAgICAgbGV0IHRhcmdldDogRGljdCA9IHt9O1xuICAgICAgT2JqZWN0LmtleXMoc291cmNlKS5mb3JFYWNoKGluZGV4ID0+IHtcbiAgICAgICAgY29uc3QgbmFtZSA9IHNvdXJjZVtpbmRleF0ubmFtZTtcbiAgICAgICAgY29uc3QgdmFsdWUgPSBzb3VyY2VbaW5kZXhdLnZhbHVlO1xuICAgICAgICB0YXJnZXRbbmFtZV0gPSB2YWx1ZTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHRhcmdldDtcbiAgfTtcblxuICBzZXRVcmwob3B0aW9uczogSWtWaWRlb0NvbXBvbmVudE9wdGlvbnMpOiB2b2lkIHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuZ2V0Q29uZmlnT2JqZWN0KG9wdGlvbnMpO1xuICAgICAgdGhpcy51cmwgPSB0aGlzLmltYWdla2l0LmdldFVybChjb25maWcpO1xuICB9XG5cbiAgZ2V0Q29uZmlnT2JqZWN0KG9wdGlvbnM6IElrVmlkZW9Db21wb25lbnRPcHRpb25zKTogYW55IHtcbiAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICB0cmFuc2Zvcm1hdGlvbjogb3B0aW9ucy50cmFuc2Zvcm1hdGlvbixcbiAgICB9O1xuICAgIGlmIChvcHRpb25zLnVybEVuZHBvaW50KSB7XG4gICAgICBjb25maWdbJ3VybEVuZHBvaW50J10gPSBvcHRpb25zLnVybEVuZHBvaW50O1xuICAgIH0gZWxzZXtcbiAgICAgIHRocm93IG5ldyBFcnJvcignTWlzc2luZyB1cmxFbmRwb2ludCBpbml0aWFsaXphdGlvbiEnKTtcbiAgICB9XG5cbiAgICBpZiAob3B0aW9ucy5xdWVyeVBhcmFtZXRlcnMpIHtcbiAgICAgIGNvbmZpZ1sncXVlcnlQYXJhbWV0ZXJzJ10gPSBvcHRpb25zLnF1ZXJ5UGFyYW1ldGVycztcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMuc3JjKSB7XG4gICAgICBjb25maWdbJ3NyYyddID0gb3B0aW9ucy5zcmM7XG4gICAgICBjb25maWdbJ3RyYW5zZm9ybWF0aW9uUG9zaXRpb24nXSA9ICdxdWVyeSc7XG4gICAgfSBlbHNlIGlmIChvcHRpb25zLnBhdGgpIHtcbiAgICAgIGNvbmZpZ1sncGF0aCddID0gb3B0aW9ucy5wYXRoO1xuICAgICAgaWYgKG9wdGlvbnMudHJhbnNmb3JtYXRpb25Qb3NpdGlvbikge1xuICAgICAgICBjb25maWdbJ3RyYW5zZm9ybWF0aW9uUG9zaXRpb24nXSA9IG9wdGlvbnMudHJhbnNmb3JtYXRpb25Qb3NpdGlvbjtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdNaXNzaW5nIHNyYyAvIHBhdGggZHVyaW5nIGluaXRpYWxpemF0aW9uIScpO1xuICAgIH1cbiAgICByZXR1cm4gY29uZmlnO1xuICB9XG5cbiAgc2V0RWxlbWVudEF0dHJpYnV0ZXMoZWxlbWVudDogYW55LCBhdHRyaWJ1dGVzTGl0ZXJhbDogRGljdCk6IHZvaWQge1xuICAgIE9iamVjdC5rZXlzKGF0dHJpYnV0ZXNMaXRlcmFsKS5mb3JFYWNoKGF0dHJOYW1lID0+IHtcbiAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoYXR0ck5hbWUsIGF0dHJpYnV0ZXNMaXRlcmFsW2F0dHJOYW1lXSk7XG4gICAgfSk7XG4gIH1cbn0iXX0=